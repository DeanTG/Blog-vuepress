---
title: 微信h5及微信支付
date: 2017-05-18 21:58:47
categories: 
- 微信
tags:
- 微信h5
- 微信JSSDK（分享，支付）
---

## 项目背景
* 项目名：创合汇慕课。
* 概述：具有直播功能的演说慕课网站，包含会员系统，评论系统，笔记，微信支付，微信分享。

## 开发流程
[参考](http://www.baidu.com)

1. 用户进入公众号，通过授权链接回调进入首页（授权链接只能携带两个参数）。
2. 授权链接返回的url上带有参数code，通过code参数向后台请求openid。openid是唯一账号的认证。
3. 登录系统，本地存储登录时间，请求到的过期时间，token,code（用来刷新token），loginType（游客，随便看看用户，注册用户）
4. 进入到首页的时候判断本地存储的loginType类型，如果是游客，跳转到登陆页，如果是随便看看，直接进首页，如果是注册用户获取本地token。
5. token，作为所有非首页展示页面的请求令牌。注册用户获取token，判断token是否存在，不存在跳转登陆页，存在继续判断是否过期，过期跳登陆页。

## JSSDK调用
1. 首先在页面js最前面加载jweixin.js文件，用于初始化签名参数。（js安全域名）
2. 获取js签名参数，通过token，openid等参数请求js签名参数，配置wx.config
3. 通过wx.ready()函数初始化完成之后调用jssdk里的方法。